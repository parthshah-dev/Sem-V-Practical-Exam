-- ============================================================
-- Library Fine Calculation & Book Return Program
-- ============================================================

CREATE TABLE Borrower (
    Roll_no     NUMBER PRIMARY KEY,
    NameofBook  VARCHAR2(50),
    DateofIssue DATE,
    Status      CHAR(1)
);

CREATE TABLE Fine (
    FineID    NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    Roll_no   NUMBER,
    FineDate  DATE,
    Amt       NUMBER,
    FOREIGN KEY (Roll_no) REFERENCES Borrower(Roll_no)
);

INSERT ALL
    INTO Borrower VALUES (1, 'Database Systems', SYSDATE - 20, 'I')
    INTO Borrower VALUES (2, 'Operating Systems', SYSDATE - 10, 'I')
    INTO Borrower VALUES (3, 'Computer Networks', SYSDATE - 35, 'I')
SELECT * FROM DUAL;

COMMIT;

ACCEPT v_roll NUMBER PROMPT 'Enter Roll No: '
ACCEPT v_book CHAR PROMPT 'Enter Book Name: '

SET SERVEROUTPUT ON;

DECLARE
    v_rollno      NUMBER := &v_roll;
    v_bookname    VARCHAR2(50) := '&v_book';
    v_dateissue   DATE;
    v_days        NUMBER;
    v_fine        NUMBER := 0;

BEGIN
    SELECT DateofIssue INTO v_dateissue
    FROM Borrower
    WHERE Roll_no = v_rollno AND NameofBook = v_bookname AND Status = 'I';

    v_days := TRUNC(SYSDATE - v_dateissue);

    IF v_days <= 15 THEN
        v_fine := 0;
    ELSIF v_days > 15 AND v_days <= 30 THEN
        v_fine := (v_days - 15) * 5;
    ELSE
        v_fine := (15 * 5) + ((v_days - 30) * 50);
    END IF;

    UPDATE Borrower
    SET Status = 'R'
    WHERE Roll_no = v_rollno AND NameofBook = v_bookname;

    IF v_fine > 0 THEN
        INSERT INTO Fine (Roll_no, FineDate, Amt)
        VALUES (v_rollno, SYSDATE, v_fine);
    END IF;

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('Book Returned Successfully.');
    DBMS_OUTPUT.PUT_LINE('Days Kept: ' || v_days);
    DBMS_OUTPUT.PUT_LINE('Fine Amount: ' || v_fine);

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('No record found for given Roll_no and Book.');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/



Theory: PL/SQL Program for Library Fine Calculation and Book Return

This program is used to calculate the library fine based on the number of days a book is kept after issue and to update the return status of the book. It demonstrates the use of conditional statements, date functions, DML operations, and exception handling in PL/SQL.

Two tables are created:

    - Borrower – stores details of issued books such as roll number, book name, date of issue, and status (Issued/Returned).

    - Fine – stores fine details for late returns including roll number, fine date, and amount.

When the user enters a roll number and book name, the program retrieves the issue date and calculates the number of days the book was kept using SYSDATE - DateofIssue. Based on the number of days, the fine is calculated as:

    - No fine if returned within 15 days

    - ₹5 per day for 16–30 days

    - ₹50 per day beyond 30 days

The borrower’s status is updated to 'R' for returned, and if a fine exists, it is recorded in the Fine table.

The program also includes exception handling using NO_DATA_FOUND to handle invalid input and OTHERS to catch general errors.

This PL/SQL program effectively shows how business logic and calculations can be automated using procedural features in SQL.