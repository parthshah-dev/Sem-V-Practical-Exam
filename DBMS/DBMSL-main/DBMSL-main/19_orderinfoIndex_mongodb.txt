Question:
Collection schema (Perform on Mongo Terminal)

{
  cust_id:123,
  cust_name:"abc",
  status:"A",
  price:250
}
i. Find the total price for each customer and display in the order of total price.
ii. Display the average price for each customer grouped by status
iii. Create simple index on orderinfo collection
iv. Create the complex index on orderinfo collection and fire the queries and drop the duplicates

============== Answer ================
Step 1: Start Mongo Shell
mongosh

Step 2: Create Database and Collection
use shopDB

db.createCollection("orderinfo")

Step 3: Insert Sample Data
db.orderinfo.insertMany([
  {cust_id:123, cust_name:"abc", status:"A", price:250},
  {cust_id:124, cust_name:"def", status:"B", price:400},
  {cust_id:125, cust_name:"ghi", status:"A", price:300},
  {cust_id:126, cust_name:"abc", status:"A", price:200}
])

Query Execution and Answers
i. Total price for each customer (ordered by total)
db.orderinfo.aggregate([
  { $group: { _id: "$cust_name", total_price: { $sum: "$price" } } },
  { $sort: { total_price: 1 } }
])

ii. Average price for each customer grouped by status
db.orderinfo.aggregate([
  { $group: { _id: "$status", avg_price: { $avg: "$price" } } }
])

iii. Create a simple index on cust_name
db.orderinfo.createIndex({ cust_name: 1 })

iv. Create a complex index on cust_name and status, remove duplicates
db.orderinfo.createIndex({ cust_name: 1, status: 1 }, { unique: true })

// Optional: To remove duplicates (if any)
db.orderinfo.aggregate([
  { $group: { _id: { cust_name: "$cust_name", status: "$status" }, dups: { $addToSet: "$_id" }, count: { $sum: 1 } } },
  { $match: { count: { $gt: 1 } } }
]).forEach(function(doc) {
  doc.dups.shift(); // keep one
  db.orderinfo.deleteMany({_id: {$in: doc.dups}});
});

------------------------
Theory
What is MongoDB
MongoDB is an open-source, document-oriented NoSQL database that stores data in BSON format, supporting fast querying, indexing, and aggregation operations.

Practical Related Concepts
1. Aggregation ($group, $sum, $avg, $sort):
Groups documents by key, computes totals or averages.
Syntax:
db.collection.aggregate([
  { $group: { _id: "$field", total: { $sum: "$field2" } } }
])

2. Indexing:
Speeds up query operations.
Simple index: single field
Compound index: multiple fields, can enforce uniqueness
Syntax:
db.collection.createIndex({ field1: 1, field2: 1 }, { unique: true })

3. Duplicate removal:
Duplicates can be identified using $group and deleted using _id references.

4. $group operator:
Aggregates documents by specified key and performs operations like $sum, $avg, $max, $min.

5. $sort operator:
Sorts aggregation results ascending (1) or descending (-1).
----------------------

(
Explanation
Aggregation computes totals and averages per customer or per status.
Simple index speeds up queries on a single field.
Compound index helps queries that filter on multiple fields.
Duplicate removal ensures uniqueness when creating compound indexes.
)
