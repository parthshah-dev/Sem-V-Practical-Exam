Question:
Write a PL/SQL block of code for the following requirements:
Schema:
Borrower(Rollin, Name, DateofIssue, NameofBook, Status)
Fine(Roll_no, Date, Amt)
Requirements:
  Accept roll_no & name of book from user.
  Check the number of days (from date of issue), if days are between 15 to 30 then fine amount will be Rs 5 per day.
  If no. of days > 30, per day fine will be Rs 50 per day & for days less than 15, Rs 5 per day.
  After submitting the book, status will change from I to R.
  If condition of fine is true, then details will be stored into Fine table.

==================== Answer ====================
Step 1: Start SQL*Plus
Open a terminal and start SQL*Plus:
sqlplus username/password@database

or simply:
sqlplus / as sysdba
depending on your setup.

Step 2: Create Required Tables
CREATE TABLE Borrower (
    Roll_no     NUMBER PRIMARY KEY,
    NameofBook  VARCHAR2(30),
    DateofIssue DATE,
    Status      CHAR(1)   -- 'I' = Issued, 'R' = Returned
);

CREATE TABLE Fine (
    FineID    NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    Roll_no   NUMBER,
    FineDate  DATE,
    Amt       NUMBER,
    FOREIGN KEY (Roll_no) REFERENCES Borrower(Roll_no)
);

Step 3: Insert Sample Records
INSERT ALL
    INTO Borrower VALUES (1, 'Database Systems', SYSDATE - 20, 'I')
    INTO Borrower VALUES (2, 'Operating Systems', SYSDATE - 10, 'I')
    INTO Borrower VALUES (3, 'Computer Networks', SYSDATE - 35, 'I')
SELECT * FROM DUAL;

COMMIT;

Step 4: PL/SQL Program (Fine Calculation & Book Return)
Save the following program in a file, e.g., library_fine.sql in your home directory:
---------------------
SET SERVEROUTPUT ON;

DECLARE
    v_rollno      NUMBER := &v_roll;
    v_bookname    VARCHAR2(30) := '&v_book';
    v_dateissue   DATE;
    v_days        NUMBER;
    v_fine        NUMBER := 0;

BEGIN
    -- Fetch Date of Issue
    SELECT DateofIssue INTO v_dateissue
    FROM Borrower
    WHERE Roll_no = v_rollno AND NameofBook = v_bookname AND Status = 'I';

    -- Days kept
    v_days := TRUNC(SYSDATE - v_dateissue);

    -- Fine Calculation
    IF v_days <= 15 THEN
        v_fine := 0;
    ELSIF v_days > 15 AND v_days <= 30 THEN
        v_fine := (v_days - 15) * 5;
    ELSE
        v_fine := (15 * 5) + ((v_days - 30) * 50);
    END IF;

    -- Update status
    UPDATE Borrower
    SET Status = 'R'
    WHERE Roll_no = v_rollno AND NameofBook = v_bookname;

    -- Insert fine if any
    IF v_fine > 0 THEN
        INSERT INTO Fine (Roll_no, FineDate, Amt)
        VALUES (v_rollno, SYSDATE, v_fine);
    END IF;

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('Book Returned Successfully.');
    DBMS_OUTPUT.PUT_LINE('Days Kept: ' || v_days);
    DBMS_OUTPUT.PUT_LINE('Fine Amount: ' || v_fine);

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('No record found for given Roll_no and Book.');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/
---------------
Step 5: Execute the Program in SQL*Plus
If your file library_fine.sql is stored in your home directory:
@/home/username/library_fine.sql

SQL*Plus will prompt for:
Enter Roll No: 
Enter Book Name:
Provide the values interactively, e.g., 1 and Database Systems.

Step 6: Verify Results
-- Check updated Borrower table
SELECT * FROM Borrower;

-- Check Fine table
SELECT * FROM Fine;

------------------------------------------
Theory (One Page Approx.)
What is PL/SQL:
PL/SQL (Procedural Language for SQL) is Oracleâ€™s procedural extension of SQL that allows variables, loops, conditions, and exception handling for managing data and business logic.

Practical Related Concepts:
Tables:
Store structured data in rows and columns.
Syntax: CREATE TABLE table_name(column datatype, ...)

Date Calculation:
TRUNC(SYSDATE - DateColumn) gives the number of days between two dates.

Conditional Logic:
IF...ELSIF...ELSE is used to calculate fines based on days.

Update Statement:
UPDATE table SET column=value WHERE condition; updates status from 'I' to 'R'.

Insert Statement:
INSERT INTO table(columns) VALUES(values); stores fine details if applicable.

Exception Handling:
Handles errors like NO_DATA_FOUND and unexpected errors with WHEN OTHERS.

DBMS_OUTPUT:
Used to display output messages in SQL*Plus, like fine amount and days kept.

Commit:
Saves all changes made in the transaction to the database.
----------------------------------------
